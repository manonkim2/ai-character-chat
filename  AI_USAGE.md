# AI Usage (Claude API ν™μ© μ •λ¦¬)

## π“ κ°μ”

λ³Έ ν”„λ΅μ νΈλ” **Claude API**λ¥Ό ν™μ©ν•μ—¬ AI μΊλ¦­ν„°λ³„ λ€ν™” κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤.  
Claudeμ κ°•μ μΈ **κΈ΄ λ§¥λ½ μ μ§€**μ™€ **μ•μ •μ μΈ ν…μ¤νΈ μ‘λ‹µ**μ„ ν†µν•΄ μ‚¬μ©μ κ²½ν—μ„ κ°•ν™”ν–μµλ‹λ‹¤.

---

## π”‘ API Key κ΄€λ¦¬

- `ANTHROPIC_API_KEY`λ” **μ„λ²„ ν™κ²½λ³€μ**μ—μ„λ§ κ΄€λ¦¬ν•©λ‹λ‹¤.
- `.env.example`μ— ν‚¤ ν•­λ©μ„ ν¬ν•¨μ‹μΌ, λ΅μ»¬ μ‹¤ν–‰ μ‹ μ†μ‰½κ² μ„¤μ • κ°€λ¥.
- ν΄λΌμ΄μ–ΈνΈ μ½”λ“μ—λ” API ν‚¤κ°€ μ λ€ λ…Έμ¶λμ§€ μ•λ„λ΅, **Next.js Route Handler**λ¥Ό ν†µν•΄ ν”„λ΅μ‹ μ”μ²­μ„ κµ¬μ„±ν–μµλ‹λ‹¤.

---

## β™οΈ μ”μ²­ νλ¦„

1. **ν΄λΌμ΄μ–ΈνΈ** β†’ `/api/chat` μ—”λ“ν¬μΈνΈλ΅ λ©”μ‹μ§€ μ „μ†΅
2. **μ„λ²„(Route Handler)** β†’ Anthropic Claude API νΈμ¶
3. **SSE(Server-Sent Events)**λ¥Ό ν†µν•΄ μ‘λ‹µμ„ μ¤νΈλ¦¬λ°μΌλ΅ μ „λ‹¬
4. **ν΄λΌμ΄μ–ΈνΈ** β†’ μ¤νΈλ¦¬λ° λΈνƒ€λ¥Ό λ°›μ•„ λ€ν™”μ°½μ— μ‹¤μ‹κ°„ λ°μ

---

## π“¤ API μ”μ²­ μμ‹

```ts
const resp = await fetch("https://api.anthropic.com/v1/messages", {
  method: "POST",
  headers: {
    "x-api-key": process.env.ANTHROPIC_API_KEY!,
    "anthropic-version": "2023-06-01",
    "content-type": "application/json",
  },
  body: JSON.stringify({
    model: "claude-3-5-sonnet-20240620",
    max_tokens: 512,
    stream: true,
    messages: [{ role: "user", content: "μ•λ…•! μκΈ°μ†κ° ν•΄μ¤" }],
  }),
});
```

---

## π“¥ μ‘λ‹µ μ¤νΈλ¦¬λ° μ²λ¦¬

- Claude APIλ” **SSE μ΄λ²¤νΈ μ¤νΈλ¦Ό**μΌλ΅ κ²°κ³Όλ¥Ό λ°ν™ν•©λ‹λ‹¤.
- μ΄λ²¤νΈ νƒ€μ…λ³„ μ²λ¦¬:
  - `message_start` β†’ μ‘λ‹µ λ©”μ‹μ§€ μ΄κΈ°ν™”
  - `content_block_delta` β†’ ν…μ¤νΈ λΈνƒ€ μ¶”κ°€
  - `message_stop` β†’ μµμΆ… μ™„λ£ μƒνƒλ΅ μ—…λ°μ΄νΈ
- ν΄λΌμ΄μ–ΈνΈλ” `TextDecoder`λ΅ μ¤νΈλ¦Όμ„ λ””μ½”λ”©ν•κ³ , `useChat` ν›…μ„ ν†µν•΄ μ‹¤μ‹κ°„μΌλ΅ UIμ— λ°μν•©λ‹λ‹¤.

---

## π§© ν”„λ΅¬ν”„νΈ μ„¤κ³„

- μΊλ¦­ν„°λ³„ λ§ν¬/μ„±κ²©μ„ μ μ§€ν•κΈ° μ„ν•΄ **System Prompt**λ¥Ό μ •μν–μµλ‹λ‹¤.
- μμ‹:
  - μΊλ¦­ν„° A: β€μƒλƒ¥ν•κ³  μΉμ ν• μ΅°μ–Έκ°€. λ”°λ»ν•κ² λ‹µλ³€.β€
  - μΊλ¦­ν„° B: β€λ‚ μΉ΄λ΅μ΄ λ¶„μ„κ°€. μ‚¬μ‹¤ κΈ°λ°μΌλ΅ λƒ‰μ² ν•κ² λ€λ‹µ.β€
- μ‚¬μ©μ μ •μ μΊλ¦­ν„°λ” μ…λ ¥ν• ν”„λ΅¬ν”„νΈλ¥Ό DB(Supabase + Prisma)μ— μ €μ¥ν•κ³  μ¬μ‚¬μ©ν•©λ‹λ‹¤.

---

## π›΅οΈ μ—λ¬ λ° λ„¤νΈμ›ν¬ μ²λ¦¬

- **200μ μ ν•**: μ„λ²„/ν΄λΌμ΄μ–ΈνΈ μ–‘μ½μ—μ„ κ²€μ¦
- **μ—λ¬ μ¬μ‹λ„ λ΅μ§**: 3ν μ§€μ λ°±μ¤ν”„ μ¬μ‹λ„ κµ¬ν„
- **λ©”μ‹μ§€ μ¬μ „μ†΅ κΈ°λ¥**: κ°λ³„ λ©”μ‹μ§€ λ‹¨μ„ μ¬μ „μ†΅ κ°€λ¥ (μ‹¤ν¨ λ©”μ‹μ§€ μ„ νƒ μ¬μ‹λ„)
- **μ—λ¬ UI μ²λ¦¬**: μ‹¤ν¨ λ©”μ‹μ§€λ” λ¶‰μ€μƒ‰ ν…λ‘λ¦¬ λ° 'μ „μ†΅ μ‹¤ν¨' λ μ΄λΈ” ν‘μ‹, μƒλ‹¨ λ°°λ„λ΅ μ „μ²΄ μ‹¤ν¨ μƒνƒ μ•λ‚΄
- **Abort**: μ‚¬μ©μκ°€ μ‘λ‹µμ„ μ¤‘κ°„μ— μ·¨μ† κ°€λ¥
